<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Lab 2 Analyze a Relational Database | GEM 510: GIS for Forestry and Conservation</title>
  <meta name="description" content="Open Educational Resources for GEM 510 course at the University of British Columbia" />
  <meta name="generator" content="bookdown 0.44 and GitBook 2.6.7" />

  <meta property="og:title" content="Lab 2 Analyze a Relational Database | GEM 510: GIS for Forestry and Conservation" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Open Educational Resources for GEM 510 course at the University of British Columbia" />
  <meta name="github-repo" content="github.com/ubc-geomatics-community-of-practice/GEM510-GIS-for-Forestry-and-Conservation/book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Lab 2 Analyze a Relational Database | GEM 510: GIS for Forestry and Conservation" />
  
  <meta name="twitter:description" content="Open Educational Resources for GEM 510 course at the University of British Columbia" />
  

<meta name="author" content="Paul D. Pickell" />


<meta name="date" content="2025-11-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction-postgresql-postgis.html"/>
<link rel="next" href="cartographic-modelling-with-forest-inventories.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">An Open Geomatics Community of Practice</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-these-resources"><i class="fa fa-check"></i>How to use these resources</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-get-involved"><i class="fa fa-check"></i>How to get involved</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html"><i class="fa fa-check"></i><b>1</b> Introduction to PostgreSQL and PostGIS</a>
<ul>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#lab-overview"><i class="fa fa-check"></i>Lab Overview</a></li>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#learning-objectives"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#lab1-deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#data"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#task-1-set-up-pgadmin-and-connect-to-the-ubc-postgresql-server"><i class="fa fa-check"></i>Task 1: Set up pgAdmin and Connect to the UBC PostgreSQL server</a></li>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#task-2-explore-with-qgis"><i class="fa fa-check"></i>Task 2: Explore with QGIS</a></li>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#task-3-explore-with-arcgis-pro"><i class="fa fa-check"></i>Task 3: Explore with ArcGIS Pro</a></li>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#task-4-explore-with-psql-shell"><i class="fa fa-check"></i>Task 4: Explore with psql Shell</a></li>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#summary"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html"><i class="fa fa-check"></i><b>2</b> Analyze a Relational Database</a>
<ul>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#lab-overview-1"><i class="fa fa-check"></i>Lab Overview</a></li>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#learning-objectives-1"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#lab2-deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#data-1"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#task-1-host-your-own-postgresql-server"><i class="fa fa-check"></i>Task 1: Host your own PostgreSQL Server</a></li>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#task-2-create-a-postgis-database"><i class="fa fa-check"></i>Task 2: Create a PostGIS Database</a></li>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#task-3-import-spatial-data-using-gdal"><i class="fa fa-check"></i>Task 3: Import Spatial Data Using GDAL</a></li>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#task-4-analyze-a-postgis-database-using-sql"><i class="fa fa-check"></i>Task 4: Analyze a PostGIS Database using SQL</a></li>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#summary-1"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cartographic-modelling-with-forest-inventories.html"><a href="cartographic-modelling-with-forest-inventories.html"><i class="fa fa-check"></i><b>3</b> Cartographic Modelling with Forest Inventories</a>
<ul>
<li class="chapter" data-level="" data-path="cartographic-modelling-with-forest-inventories.html"><a href="cartographic-modelling-with-forest-inventories.html#lab-overview-2"><i class="fa fa-check"></i>Lab Overview</a></li>
<li class="chapter" data-level="" data-path="cartographic-modelling-with-forest-inventories.html"><a href="cartographic-modelling-with-forest-inventories.html#learning-objectives-2"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="cartographic-modelling-with-forest-inventories.html"><a href="cartographic-modelling-with-forest-inventories.html#lab3-deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
<li class="chapter" data-level="" data-path="cartographic-modelling-with-forest-inventories.html"><a href="cartographic-modelling-with-forest-inventories.html#data-2"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="cartographic-modelling-with-forest-inventories.html"><a href="cartographic-modelling-with-forest-inventories.html#task-1-query-and-export-data-from-ubc-postgresql-server"><i class="fa fa-check"></i>Task 1: Query and export data from UBC PostgreSQL server</a></li>
<li class="chapter" data-level="" data-path="cartographic-modelling-with-forest-inventories.html"><a href="cartographic-modelling-with-forest-inventories.html#task-2-calculate-percentage-of-old-growth-forests"><i class="fa fa-check"></i>Task 2: Calculate Percentage of Old Growth Forests</a></li>
<li class="chapter" data-level="" data-path="cartographic-modelling-with-forest-inventories.html"><a href="cartographic-modelling-with-forest-inventories.html#references"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="cartographic-modelling-with-forest-inventories.html"><a href="cartographic-modelling-with-forest-inventories.html#summary-2"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html"><i class="fa fa-check"></i><b>4</b> Exploring QGIS and OpenStreetMap</a>
<ul>
<li class="chapter" data-level="" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html#lab-overview-3"><i class="fa fa-check"></i>Lab Overview</a></li>
<li class="chapter" data-level="" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html#learning-objectives-3"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html#lab4-deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
<li class="chapter" data-level="" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html#data-3"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html#task-1-downloading-openstreetmap-data-to-qgis"><i class="fa fa-check"></i>Task 1: Downloading OpenStreetMap data to QGIS</a></li>
<li class="chapter" data-level="" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html#task-2-inspecting-and-processing-openstreetmap-data"><i class="fa fa-check"></i>Task 2: Inspecting and processing OpenStreetMap data</a></li>
<li class="chapter" data-level="" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html#task-3-simple-spatial-analysis-with-qgis"><i class="fa fa-check"></i>Task 3: Simple spatial analysis with QGIS</a></li>
<li class="chapter" data-level="" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html#summary-3"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="raster-least-cost-path-analysis.html"><a href="raster-least-cost-path-analysis.html"><i class="fa fa-check"></i><b>5</b> Raster and Least Cost Path Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="raster-least-cost-path-analysis.html"><a href="raster-least-cost-path-analysis.html#lab-overview-4"><i class="fa fa-check"></i>Lab Overview</a></li>
<li class="chapter" data-level="" data-path="raster-least-cost-path-analysis.html"><a href="raster-least-cost-path-analysis.html#learning-objectives-4"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="raster-least-cost-path-analysis.html"><a href="raster-least-cost-path-analysis.html#lab5-deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
<li class="chapter" data-level="" data-path="raster-least-cost-path-analysis.html"><a href="raster-least-cost-path-analysis.html#data-4"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="raster-least-cost-path-analysis.html"><a href="raster-least-cost-path-analysis.html#task-1-define-a-raster-area-of-interest"><i class="fa fa-check"></i>Task 1: Define a raster area of interest</a></li>
<li class="chapter" data-level="" data-path="raster-least-cost-path-analysis.html"><a href="raster-least-cost-path-analysis.html#task-2-seamless-mosaicking"><i class="fa fa-check"></i>Task 2: Seamless mosaicking</a></li>
<li class="chapter" data-level="" data-path="raster-least-cost-path-analysis.html"><a href="raster-least-cost-path-analysis.html#task-3-calculating-movement-costs"><i class="fa fa-check"></i>Task 3: Calculating movement costs</a></li>
<li class="chapter" data-level="" data-path="raster-least-cost-path-analysis.html"><a href="raster-least-cost-path-analysis.html#task-4-least-cost-path-analysis-in-arcgis-pro"><i class="fa fa-check"></i>Task 4: Least cost path analysis in ArcGIS Pro</a></li>
<li class="chapter" data-level="" data-path="raster-least-cost-path-analysis.html"><a href="raster-least-cost-path-analysis.html#summary-4"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html"><i class="fa fa-check"></i><b>6</b> Digitization and Editing with Kart</a>
<ul>
<li class="chapter" data-level="" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#lab-overview-5"><i class="fa fa-check"></i>Lab Overview</a></li>
<li class="chapter" data-level="" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#learning-objectives-5"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#lab6-deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
<li class="chapter" data-level="" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#data-5"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#task-1-configure-git-install-kart-and-create-your-first-repository"><i class="fa fa-check"></i>Task 1: Configure Git, install Kart, and create your first repository</a></li>
<li class="chapter" data-level="" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#task-2-edit-a-layer-in-qgis-with-version-control"><i class="fa fa-check"></i>Task 2: Edit a layer in QGIS with version control</a></li>
<li class="chapter" data-level="" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#task-3-working-on-and-merging-different-branches"><i class="fa fa-check"></i>Task 3: Working on and merging different branches</a></li>
<li class="chapter" data-level="" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#task-4-digitize-some-buildings-in-arcgis-pro"><i class="fa fa-check"></i>Task 4: Digitize some buildings in ArcGIS Pro</a></li>
<li class="chapter" data-level="" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#summary-5"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="geocoding.html"><a href="geocoding.html"><i class="fa fa-check"></i><b>7</b> Geocoding</a>
<ul>
<li class="chapter" data-level="" data-path="geocoding.html"><a href="geocoding.html#lab-overview-6"><i class="fa fa-check"></i>Lab Overview</a></li>
<li class="chapter" data-level="" data-path="geocoding.html"><a href="geocoding.html#learning-objectives-6"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="geocoding.html"><a href="geocoding.html#lab7-deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
<li class="chapter" data-level="" data-path="geocoding.html"><a href="geocoding.html#data-6"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="geocoding.html"><a href="geocoding.html#task-1-download-and-prepare-data"><i class="fa fa-check"></i>Task 1: Download and Prepare Data</a></li>
<li class="chapter" data-level="" data-path="geocoding.html"><a href="geocoding.html#task-2-prepare-data"><i class="fa fa-check"></i>Task 2: Prepare Data</a></li>
<li class="chapter" data-level="" data-path="geocoding.html"><a href="geocoding.html#task-3-geocoding-a-table-of-addresses"><i class="fa fa-check"></i>Task 3: Geocoding a Table of Addresses</a></li>
<li class="chapter" data-level="" data-path="geocoding.html"><a href="geocoding.html#task-4-create-a-shapefile-from-tabular-data"><i class="fa fa-check"></i>Task 4: Create a shapefile from tabular data</a></li>
<li class="chapter" data-level="" data-path="geocoding.html"><a href="geocoding.html#summary-6"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GEM 510: GIS for Forestry and Conservation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analyze-relational-database" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Lab 2</span> Analyze a Relational Database<a href="analyze-relational-database.html#analyze-relational-database" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Written by
Paul D. Pickell</p>
<div id="lab-overview-1" class="section level2 unnumbered hasAnchor">
<h2>Lab Overview<a href="analyze-relational-database.html#lab-overview-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this lab you will learn how to create, manage, and analyze your own relational database. You will continue to practice with the tools that you learned in the prior lab: pgAdmin, QGIS, ArcGIS Pro, and psql. You will also be introduced to the Geospatial Data Abstraction Library (GDAL) and some of the handy programs that are available from this software library for managing data. You will learn more advanced Structured Query Language (SQL) statements that will allow you join tables, insert and update data, and analyze data in a relational database.</p>
<hr />
</div>
<div id="learning-objectives-1" class="section level2 unnumbered hasAnchor">
<h2>Learning Objectives<a href="analyze-relational-database.html#learning-objectives-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Create and host your own PostgreSQL server with a PostGIS database</li>
<li>Apply best practices for handling, organizing, and managing data</li>
<li>Import geospatial data using the Geospatial Data Abstraction Library (GDAL)</li>
<li>Practice joining and relating tables</li>
<li>Practice inserting and updating data</li>
<li>Analyze geospatial data in a relational database using SQL and PostGIS</li>
</ul>
<hr />
</div>
<div id="lab2-deliverables" class="section level2 unnumbered hasAnchor">
<h2>Deliverables<a href="analyze-relational-database.html#lab2-deliverables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><input type="checkbox" unchecked> Dump SQL file from Task 2 (15 points)</input></p>
<p><input type="checkbox" unchecked> SQL statement (just the text) from Task 4 (15 points)</input></p>
<hr />
</div>
<div id="data-1" class="section level2 unnumbered hasAnchor">
<h2>Data<a href="analyze-relational-database.html#data-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>All data for this lab are accessible via the UBC PostgreSQL server. Instructions for connecting to the server are given in the tasks below. We will be using data from the <code>ubcv</code> database.</p>
<hr />
</div>
<div id="task-1-host-your-own-postgresql-server" class="section level2 unnumbered hasAnchor">
<h2>Task 1: Host your own PostgreSQL Server<a href="analyze-relational-database.html#task-1-host-your-own-postgresql-server" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Step 1:</strong> Open pgAdmin.</p>
<p><strong>Step 2:</strong> From the “Browser” pane on the left, right-click “Servers” and then select “Register” then “Server…”. We are going to add another server, but this time, it will be hosted on your local machine.</p>
<p><strong>Step 3:</strong> Name the server “localhost” then click the “Connection” tab and set the “Host Name/Address” also as “localhost”. Enter a password for the server and leave everything else as the default. When finished, click “Save”. The new localhost server should now appear in your Browser. You can expand it, navigate through “Databases”, “postgres”, “Schemas”, “public”, and “Tables” to find that it is indeed empty.</p>
<p><img src="images/01-pgadmin-localhost-connection.png" width="50%" /></p>
<p><strong>Step 4:</strong> Open the psql shell.</p>
<p>If you are already connected to the UBC PostgreSQL server, you can switch this connection to the localhost server you just made in pgAdmin with the following command: <code>\c "dbname=postgres host=localhost port=5432 user=postgres"</code>. You will then be prompted to enter your password.</p>
<p>Alternatively, you can open a new psql terminal window. The prompt should say <code>Server [localhost]:</code>. Press “Enter” on your keyboard to accept localhost as the server host name.</p>
<p>The prompt should then say <code>Database [postgres]:</code>. This is the default name of the database that was created when you hosted the server from pgAdmin. Press “Enter” on your keyboard to accept postgres as the database to connect to.</p>
<p>The prompt should then say <code>Port [5432]:</code>. This is the default port that the PostgreSQL server uses. Press “Enter” on your keyboard to accept the default port.</p>
<p>The prompt should then say <code>Username [postgres]:</code>. This is the default username that you created when you set up the PostgreSQL server in pgAdmin. Press “Enter” on your keyboard to accept the postgres username.</p>
<p>The prompt should then ask you for your password, <code>Password for user postgres:</code>. Type your password that you set in the earlier step with pgAdmin and then press “Enter” on your keyboard. Note that there is no feedback given to indicate what you are typing.</p>
<p>If everything is successful, then you should see <code>postgres=#</code>, which indicates you can now enter either psql commands or SQL statements. Note that the hashtag <code>#</code> indicates that you are connected to the current database with the “SUPERUSER” role, which is essentially the highest admin privilege.</p>
<hr />
</div>
<div id="task-2-create-a-postgis-database" class="section level2 unnumbered hasAnchor">
<h2>Task 2: Create a PostGIS Database<a href="analyze-relational-database.html#task-2-create-a-postgis-database" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Step 1:</strong> Create a new database called “mypostgisdb” with the following SQL command <code>CREATE DATABASE mypostgisdb;</code>. It is important to always escape SQL statements with a semi-colon otherwise psql will interpret your input as spanning multiple lines! If you forget the semi-colon, you can always just type it in the console and hit “Enter” on your keyboard and psql will interpret this as a two-line statement.</p>
<p><strong>Step 2:</strong> Connect to your new database by using the psql command <code>\c mypostgisdb</code>. Note that this is NOT an SQL statement, so there is no need to escape the command with a semi-colon. Your console should now say <code>mypostgisdb=#</code>, which indicates you are now connected.</p>
<p><strong>Step 3:</strong> Currently this is just a plain-vanilla PostgreSQL relational database that cannot handle spatial data. In order to convert this to a PostGIS database, we need to enable the PostGIS extension using the following SQL: <code>CREATE EXTENSION postgis;</code>.</p>
<p><img src="images/02-psql-create-mypostgisdb.png" width="90%" /></p>
<p>If the above step fails, then you may need to first install PostGIS. Ordinarily, PostGIS is installed at the same time as PostgreSQL, they come packaged together. To install PostGIS, follow these steps:</p>
<p><strong>Step 3a:</strong> Search “Stack Builder” from your Windows search bar and run the application.</p>
<p><img src="images/02-stack-builder-search.png" width="75%" /></p>
<p><strong>Step 3b:</strong> If prompted, enter your admin credential or ask your instructor to provide this credential for you.</p>
<p><strong>Step 3c:</strong> Select “PostgreSQL 16 (x64) on port 5432” from the drop down menu (or whatever version of PostgreSQL is installed on your machine). Click “Next”.</p>
<p><img src="images/02-stack-builder-1.png" width="75%" /></p>
<p><strong>Step 3d:</strong> Expand “Categories”, then expand “Spatial Extensions”, and toggle on the PostGIS software version to install. Click “Next”. The Application Stack Builder will prompt for where you want to download PostGIS, just click “Next” to accept the default location. Then you will be prompted to install it after it downloads. Make sure that “Skip Installation” is toggled off, and continue to click “Next” to accept the defaults, and “Agree” to the end user license agreement.</p>
<p><strong>Step 3e:</strong> After PostGIS installs successfully, close any psql shell you have open, re-open a new psql shell, and then begin again at Step 2 above.</p>
<p><strong>Step 4:</strong> Listing the tables <code>\dt</code> will reveal the database has a table called “spatial_ref_sys”. List the fields of this table with <code>\d spatial_ref_sys</code>.</p>
<p>In addition to the field names, you will see there is an index called “spatial_ref_sys_pkey”, which is the dedicated field for the primary key for this table, and a constraint check to ensure that srid’s are valid only between <span class="math inline">\(1\)</span> and <span class="math inline">\(998999\)</span>. You can test this constraint by trying to insert a new srid value of <span class="math inline">\(0\)</span>: <code>INSERT INTO spatial_ref_sys (srid) VALUES (0);</code>. The returned message,</p>
<pre><code>ERROR:  new row for relation &quot;spatial_ref_sys&quot; violates check constraint spatial_ref_sys_srid_check&quot;
DETAIL:  Failing row contains (0, null, null, null, null).</code></pre>
<p>DO NOT modify this table with any srids in the valid range otherwise you will need to recreate the PostGIS database!</p>
<p><strong>Step 5:</strong> Return the first ten rows of the table for the fields “auth_name” and “auth_srid” with <code>SELECT auth_name,auth_srid FROM spatial_ref_sys LIMIT 10;</code>.</p>
<p>This table contains EPSG codes, which are used to easily relate spheroids, datums, and measurement units to geospatial data. You will find these codes used everywhere when you look at metadata and the properties of different data layers. One very commonly used code is EPSG 4326, which references the WGS 1984 datum.</p>
<p>Use the following query to return the contents of the entire spatial_ref_sys table: <code>SELECT * FROM spatial_ref_sys;</code></p>
<p><strong>Step 6:</strong> Write an SQL query to return proj4text of the WGS 1984 datum from the spatial_ref_sys table.</p>
<p>Now we will create some new data, just to show you how to use some useful SQL keywords. We will start with aspatial data first, then move on to spatial data. You can create a new table in your database with the following syntax (note that you cannot simply copy-paste below, you need to supply actual data type variable names):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb2-1"><a href="analyze-relational-database.html#cb2-1" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="kw">table</span><span class="op">-</span>name (</span>
<span id="cb2-2"><a href="analyze-relational-database.html#cb2-2" tabindex="-1"></a>colunm<span class="op">-</span>name<span class="op">-</span><span class="dv">1</span> datatype,</span>
<span id="cb2-3"><a href="analyze-relational-database.html#cb2-3" tabindex="-1"></a>colunm<span class="op">-</span>name<span class="op">-</span><span class="dv">2</span> datatype,</span>
<span id="cb2-4"><a href="analyze-relational-database.html#cb2-4" tabindex="-1"></a>colunm<span class="op">-</span>name<span class="op">-</span><span class="dv">3</span> datatype,</span>
<span id="cb2-5"><a href="analyze-relational-database.html#cb2-5" tabindex="-1"></a><span class="op">..</span>.</span>
<span id="cb2-6"><a href="analyze-relational-database.html#cb2-6" tabindex="-1"></a>);</span></code></pre></div>
<p>Data types are very important and the shorthand notation for these in PostgreSQL are <a href="https://www.postgresql.org/docs/current/datatype.html">listed on this web page</a> and some commonly used data types are reproduced below with examples.</p>
<table>
<caption><span id="tab:unnamed-chunk-5">Table 2.1: </span>Some PostgreSQL data types with example value ranges.</caption>
<colgroup>
<col width="7%" />
<col width="56%" />
<col width="36%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">int2</td>
<td align="left">Signed 2-byte integer</td>
<td align="left">-32,768 to 32,767</td>
</tr>
<tr class="even">
<td align="left">int4</td>
<td align="left">Signed 4-byte integer</td>
<td align="left">-2,147,483,648 to 2,147,483,647</td>
</tr>
<tr class="odd">
<td align="left">int8</td>
<td align="left">Signed 8-byte integer</td>
<td align="left">-9,223,372,036,854,775,808 to 9,223,372,036,854,775,807</td>
</tr>
<tr class="even">
<td align="left">bigserial</td>
<td align="left">Autoincrementing 8-byte integer</td>
<td align="left">0 to 18,446,744,073,709,551,615</td>
</tr>
<tr class="odd">
<td align="left">float4</td>
<td align="left">Single prevision floating-point number (4 bytes)</td>
<td align="left">±10³⁸ with 6 or 7 significant digits</td>
</tr>
<tr class="even">
<td align="left">float8</td>
<td align="left">Double precision floating-point number (8 bytes)</td>
<td align="left">±10³⁰⁸ with 15 or 16 significant digits</td>
</tr>
<tr class="odd">
<td align="left">bool</td>
<td align="left">Logical Boolean</td>
<td align="left">True or False</td>
</tr>
<tr class="even">
<td align="left">char(n)</td>
<td align="left">Fixed length character string where n is the number of permitted characters</td>
<td align="left">‘Hello world!’</td>
</tr>
<tr class="odd">
<td align="left">varchar(n)</td>
<td align="left">Variable length character string where n is the maximum number of permitted characters</td>
<td align="left">‘Hello world!’ and ‘Hello’ and ‘world’ and ‘!’</td>
</tr>
<tr class="even">
<td align="left">date</td>
<td align="left">Calendar date</td>
<td align="left">31/12/2000</td>
</tr>
</tbody>
</table>
<p>Here is an example of creating a new table with some different data types:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb3-1"><a href="analyze-relational-database.html#cb3-1" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> my_new_table (</span>
<span id="cb3-2"><a href="analyze-relational-database.html#cb3-2" tabindex="-1"></a>this_field_is_int2 int2,</span>
<span id="cb3-3"><a href="analyze-relational-database.html#cb3-3" tabindex="-1"></a>this_field_is_bool bool,</span>
<span id="cb3-4"><a href="analyze-relational-database.html#cb3-4" tabindex="-1"></a>this_field_is_varchar_50 <span class="dt">varchar</span>(<span class="dv">50</span>)</span>
<span id="cb3-5"><a href="analyze-relational-database.html#cb3-5" tabindex="-1"></a>);</span></code></pre></div>
<p><img src="images/02-psql-mynewtable.png" width="90%" /></p>
<p>Watch out for unescaped parentheses when running multiline SQL statements! If you see <code>mypostgisdb=#</code>, then you are able to submit a new psql command or start an SQL statement. If you see <code>mypostgisdb=-</code>, then you have already started an SQL statement on a line above in the terminal. If you see <code>mypostgisdb=(</code>, then you have added an open parenthesis ‘(’ somewhere in your statement on a line above. When running a SQL statement over multiple lines, you need to ensure that you enclose all parentheses and end the statement with a semicolon <code>;</code> in order to return the psql command line back to <code>mypostgisdb=#</code>. If you find yourself stuck an unable to exit <code>mypostgisdb=(</code>, try to close any open parentheses by typing <code>)</code> and pressing “Enter”. If you find yourself unable to exit <code>mypostgisdb=-</code>, try ending the SQL statement by typing <code>;</code> and pressing “Enter”. If both of those fail, you can try exiting the command with <code>CTRL + C</code>, which may also end psql and require you to reconnect to the database.</p>
<p>You can experiment with creating as many new tables as you want. If you need to delete a table, use the <code>DROP</code> keyword like this <code>DROP TABLE my_new_table;</code>.</p>
<p>It is good practice to assign a field (multiple fields) as a primary key when you create a table. This is done by simply adding <code>PRIMARY KEY</code> after the field definition when you make the table. For example:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb4-1"><a href="analyze-relational-database.html#cb4-1" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> my_new_table (</span>
<span id="cb4-2"><a href="analyze-relational-database.html#cb4-2" tabindex="-1"></a>this_field_is_bigserial bigserial <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb4-3"><a href="analyze-relational-database.html#cb4-3" tabindex="-1"></a>this_field_is_int2 int2,</span>
<span id="cb4-4"><a href="analyze-relational-database.html#cb4-4" tabindex="-1"></a>this_field_is_bool bool,</span>
<span id="cb4-5"><a href="analyze-relational-database.html#cb4-5" tabindex="-1"></a>this_field_is_varchar_50 <span class="dt">varchar</span>(<span class="dv">50</span>)</span>
<span id="cb4-6"><a href="analyze-relational-database.html#cb4-6" tabindex="-1"></a>);</span></code></pre></div>
<p>The bigserial data type is especially useful for this purpose because it auto-increments as you add rows and can accommodate more than 18 <em>quintrillion</em> rows, that is more than 18 million trillions! You can also create composite primary keys that are comprised of two or more fields to uniquely identify all rows:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb5-1"><a href="analyze-relational-database.html#cb5-1" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> my_new_table ( </span>
<span id="cb5-2"><a href="analyze-relational-database.html#cb5-2" tabindex="-1"></a>this_field_is_int2 int2,</span>
<span id="cb5-3"><a href="analyze-relational-database.html#cb5-3" tabindex="-1"></a>this_field_is_bool bool,</span>
<span id="cb5-4"><a href="analyze-relational-database.html#cb5-4" tabindex="-1"></a>this_field_is_varchar_50 <span class="dt">varchar</span>(<span class="dv">50</span>),</span>
<span id="cb5-5"><a href="analyze-relational-database.html#cb5-5" tabindex="-1"></a><span class="kw">PRIMARY</span> <span class="kw">KEY</span>(this_field_is_int2, this_field_is_bool)</span>
<span id="cb5-6"><a href="analyze-relational-database.html#cb5-6" tabindex="-1"></a>);</span></code></pre></div>
<p>Note that if you use a compound primary key, like in the example above, or if you use one of your data fields as the primary key, then you are imposing a logic onto the table that prevents you from creating, updating, or inserting new rows that duplicate those values or combinations of values. After all, that is the purpose of a primary key, to uniquely identify all the tuples. Sometimes, this logic can be useful in the design of a table, but generally it is best practice to create a dedicated field for the primary key and this is also the behaviour that you will observe in attribute tables viewed in ArcGIS Pro and QGIS.</p>
<p><strong>Step 7:</strong> Create a new table of assignments that are due next week (up to four total). Include course code, assignment name, the percent weighting of the assignment on your final grade in that course, and the due date. Use the appropriate data types for each field and define a primary key.</p>
<p>Now that the table and fields are defined, we will insert some data into the table. Inserting data uses the <code>INSERT</code> keyword followed by <code>VALUES</code> and then a comma-separated list of the values you want to insert in parentheses. For example:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb6-1"><a href="analyze-relational-database.html#cb6-1" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> my_new_table <span class="kw">VALUES</span> (<span class="dv">32767</span>, <span class="kw">false</span>, <span class="st">&#39;hello world!&#39;</span>);</span></code></pre></div>
<p><img src="images/02-psql-insert.png" width="90%" /></p>
<p>If you want to insert a value for specific fields, then specify the field name(s) after the table name:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb7-1"><a href="analyze-relational-database.html#cb7-1" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> my_new_table (this_field_is_int2, this_field_is_varchar_50) <span class="kw">VALUES</span> (<span class="op">-</span><span class="dv">32768</span>,<span class="st">&#39;hi again!&#39;</span>);</span></code></pre></div>
<p><img src="images/02-psql-insert-2.png" width="90%" /></p>
<p>If you make a mistake or need to update a field later, then you use <code>UPDATE</code> and <code>SET</code> to identify the set of fields that should be updated. You can also test for NULL (empty values) using <code>IS NULL</code> or <code>IS NOT NULL</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb8-1"><a href="analyze-relational-database.html#cb8-1" tabindex="-1"></a><span class="kw">UPDATE</span> my_new_table</span>
<span id="cb8-2"><a href="analyze-relational-database.html#cb8-2" tabindex="-1"></a><span class="kw">SET</span> this_field_is_bool <span class="op">=</span> <span class="kw">true</span>, this_field_is_varchar_50 <span class="op">=</span> <span class="st">&#39;whoops!&#39;</span></span>
<span id="cb8-3"><a href="analyze-relational-database.html#cb8-3" tabindex="-1"></a><span class="kw">WHERE</span> this_field_is_bool <span class="kw">IS</span> <span class="kw">NULL</span>;</span></code></pre></div>
<p><img src="images/02-psql-update.png" width="90%" /></p>
<p>Dates require special handling because if you just try to insert them as strings or otherwise, they are treated as literals. For dates, we need to use the special <code>TO_DATE</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb9-1"><a href="analyze-relational-database.html#cb9-1" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> my_new_table (this_field_is_date) <span class="kw">VALUES</span> (<span class="fu">TO_DATE</span>(<span class="st">&#39;31-12-1963&#39;</span>, <span class="st">&#39;DD-MM-YYYY&#39;</span>));</span></code></pre></div>
<p><strong>Step 8:</strong> Now fill in your table of assignments by inserting and/or updating the values as needed.</p>
<p>Once you are satisfied with the state of your table, you will dump your entire PostGIS database to an output SQL file and this will be one of your deliverables for this lab. PostgreSQL features a utility program called <code>pg_dump</code> that will take any database and output an SQL statement in a file that can be used to re-create the database. In other words, <code>pg_dump</code> is a backup method. This is also really handy if you want to create a local backup of a remote server! If you want more practice, try using it on the UBC PostgreSQL server.</p>
<p><strong>Step 9:</strong> Open a Windows command prompt (search “command”). Take note of your current working directory, which is probably something like <code>C:\Users\[your username]</code>. This is where your database SQL file will be saved to. If your command prompt shows your working directory as <code>C:\Program Files\QGIS X.XX.X</code> or similar, then you will first need to change to a directory where you have permission to write to. Usually, this is somewhere in your user folder, which you can navigate to in the terminal with the change directory <code>cd</code> command: <code>cd C:\Users\[your username]\Documents</code>.</p>
<p>To dump your database, use the following command: <code>pg_dump -d mypostgisdb -U postgres -h localhost &gt; mypostgisdb.sql</code>. You will be prompted to enter your password and then the new file <code>mypostgisdb.sql</code> will be saved in your working directory. If you see a command not found message, then type <code>where pg_dump</code>. Then copy the full path to the program executable when running the commands that follow, usually <code>"C:\Program Files\PostgreSQL\16\bin"</code>. Copy the path and then in command prompt type <code>set PATH=%PATH%;"C:\Program Files\PostgreSQL\16\bin"</code>, replacing <code>X.XX.X</code> with your current QGIS version. Try the <code>pg_dump</code> command again to ensure it works.</p>
<p><strong>Step 10:</strong> Check to make sure that you can load the database back into PostgreSQL. In psql, create a new empty database named mypostgisdb_backup. Then, enter the following command from the Windows command prompt: <code>psql -U postgres -h localhost mypostgisdb_backup &lt; mypostgisdb.sql</code>. You can now query the postgisdb_backup database to check that it is a copy of your other mypostgisdb database.</p>
<hr />
</div>
<div id="task-3-import-spatial-data-using-gdal" class="section level2 unnumbered hasAnchor">
<h2>Task 3: Import Spatial Data Using GDAL<a href="analyze-relational-database.html#task-3-import-spatial-data-using-gdal" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that you have some basic understanding of viewing and manipulating tables, we are going to look at some ways to import spatial data into your PostGIS database. To do this, we will be working with some utility programs in the Geospatial Data Abstraction Library (GDAL) pronounced “gee-dall”. You will probably find the <a href="https://gdal.org/programs/">GDAL documentation pages</a> very helpful for reference. GDAL is used in ArcGIS, GRASS, SAGA, QGIS, ENVI, Google Earth, and also has <a href="https://gdal.org/api/python_bindings.html">Python bindings</a> and an <a href="https://cran.r-project.org/web/packages/rgdal/index.html">R package with bindings</a>. In short, GDAL is largely the workhorse behind most open source geospatial software packages.</p>
<p><strong>Step 1:</strong> Open the OSGeo4W shell by searching for it in Windows. Enter the command <code>o-help</code> and inspect all the available programs.</p>
<p>You might notice <code>psql</code> can be run from the OSGeo4W shell and <code>pg_dump</code> is also there. Some others we will cover in later labs, including <code>pdal</code> (Point Data Abstraction Library) pronounced “poodle” or “pee-dahl”, which handles LiDAR data, and many of the raster and image manipulation programs. For this lab, we are going to focus on two commonly used vector programs: <a href="https://gdal.org/programs/ogrinfo.html">ogrinfo</a> and <a href="https://gdal.org/programs/ogr2ogr.html">ogr2ogr</a>.</p>
<p><strong>Step 2:</strong> Type <code>ogr2ogr --help</code> in the console and press “Enter” on your keyboard. Inspect all the flags <code>-</code> and arguments for this program. If you see a command not found message, then type <code>where ogr2ogr</code>. Then copy the full path to the program executable when running the commands that follow, usually <code>"C:\Program Files\QGIS X.XX.X\bin\"</code>. Copy the path and then in command prompt type <code>set PATH=%PATH%;"C:\Program Files\QGIS X.XX.X\bin\"</code>, replacing <code>X.XX.X</code> with your current QGIS version. Try <code>ogr2ogr --help</code> again to ensure it works.</p>
<p>ogr2ogr is the primary utility program for working with vector data and as you can see, there are a lot of options! To show you some of the power of this little application, we are going to export some data from the UBC PostgreSQL server to our local machine, manipulate it, and then import it to our local PostGIS database.</p>
<p><strong>Step 3:</strong> ogr2ogr is really useful for converting data between different formats and this is handy for exporting data out of a PostGIS database. Convert the ubcv_campus_trees table from the UBC PostgreSQL server with the following command:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="analyze-relational-database.html#cb10-1" tabindex="-1"></a><span class="ex">ogr2ogr</span> <span class="at">-f</span> <span class="st">&quot;ESRI Shapefile&quot;</span> ubcv_campus_trees.shp PG:<span class="st">&quot;host=FRST-PostgreSQL.ead.ubc.ca user=student dbname=ubcv password=STUDENT_PASSWORD_HERE&quot;</span> <span class="st">&quot;ubcv_campus_trees&quot;</span></span></code></pre></div>
<p>Replace <code>STUDENT_PASSWORD_HERE</code> with the password that has been shared with the class.</p>
<p>This command tells ogr2ogr to connect to the ubcv PostGIS database on the PostgreSQL server <code>PG:"host=FRST-PostgreSQL.ead.ubc.ca user=student dbname=ubcv password=STUDENT_PASSWORD_HERE"</code>, grab the table named <code>"ubcv_campus_trees"</code>, and then return it to the local machine as an ESRI Shapefile <code>-f "ESRI Shapefile"</code>. The file will be saved in your current working directory from the OSGeo4W shell.</p>
<p><strong>Step 4:</strong> You can also specify an SQL query on the input data. For example, the following command will only return the Forest Sciences Centre polygon from ubcv_buildings:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="analyze-relational-database.html#cb11-1" tabindex="-1"></a><span class="ex">ogr2ogr</span> <span class="at">-where</span> <span class="st">&quot;bldg_code=&#39;FSC&#39;&quot;</span> <span class="at">-f</span> <span class="st">&quot;ESRI Shapefile&quot;</span> ubcv_FSC.shp PG:<span class="st">&quot;host=FRST-PostgreSQL.ead.ubc.ca user=student dbname=ubcv password=STUDENT_PASSWORD_HERE&quot;</span> <span class="st">&quot;ubcv_buildings&quot;</span></span></code></pre></div>
<p>You can write more complex SQL statements with the <code>-sql</code> flag instead of <code>-where</code>.</p>
<p><strong>Step 5:</strong> Getting data into a PostGIS database is unremarkably similar as to taking it out. Import the FSC polygon into your localhost PostGIS database using the same command as Step 3, but change the following:</p>
<ul>
<li><code>"ESRI Shapefile"</code> to <code>"PostgreSQL"</code></li>
<li>delete <code>ubcv_campus_trees.shp</code></li>
<li>modify the connection parameters for your localhost server</li>
<li>change <code>"ubcv_campus_trees"</code> to <code>ubcv_FSC.shp</code></li>
<li>specify that we want these data re-projected into UTM Zone 10N coordinates <code>-t_srs EPSG:3157</code></li>
</ul>
<p>You will receive no feedback in the terminal if you were successful, but you can check in QGIS, ArcGIS Pro, or by using the ogrinfo program.</p>
<p>ogrinfo is a utility that is able to read a wide-variety of spatial data formats and return metadata for inspection. This program is useful for getting the geometry type of a file, the spatial extent of the features, and the coordinate system or the datum. You can also apply SQL queries and even inspect the attributes of specific features.</p>
<p><strong>Step 6:</strong> Check that the FSC polygon was successfully added to your PostGIS database with the following command:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="analyze-relational-database.html#cb12-1" tabindex="-1"></a><span class="ex">ogrinfo</span> PG:<span class="st">&quot;host=localhost user=postgres dbname=mypostgisdb password=YOUR_LOCALHOST_PASSWORD&quot;</span> <span class="st">&quot;ubcv_FSC&quot;</span> <span class="at">-so</span></span></code></pre></div>
<p>The screenshot below is a small snippet of what is returned in the OSGeo4W terminal window. As you can see, we have access to the feature count, spatial extent, Spatial Reference System (SRS), and even all the field names and data types if you scroll farther down. The <code>-so</code> flag gives us this “summary output”.</p>
<p><img src="images/02-ogrinfo-fsc.png" width="90%" /></p>
<p><strong>Step 7:</strong> Repeat this process to import the ubcv_campus_trees.shp you created in Step 3 to your localhost PostGIS database.</p>
<hr />
</div>
<div id="task-4-analyze-a-postgis-database-using-sql" class="section level2 unnumbered hasAnchor">
<h2>Task 4: Analyze a PostGIS Database using SQL<a href="analyze-relational-database.html#task-4-analyze-a-postgis-database-using-sql" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now let us have some fun and explore some of the cool spatial processing features of our PostGIS database. PostGIS supports an unfathomable number of <a href="https://postgis.net/docs/reference.html#Spatial_Relationships">spatial operations</a> that you would ordinarily find in GIS software like QGIS and ArcGIS. This task is merely to give you a taste of what is possible with SQL and PostGIS.</p>
<p>Suppose we want to know what species of trees are planted next to the Forest Sciences Centre at UBC.</p>
<p><strong>Step 1:</strong> Open psql and connect to your mypostgisdb database on your localhost PostgreSQL server.</p>
<p><strong>Step 2:</strong> Buffer the ubcv_fsc polygon with the following SQL statement:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb13-1"><a href="analyze-relational-database.html#cb13-1" tabindex="-1"></a><span class="kw">SELECT</span> ST_Buffer(wkb_geometry, <span class="dv">15</span>) <span class="kw">INTO</span> ubcv_fsc_buffer <span class="kw">FROM</span> ubcv_fsc;</span></code></pre></div>
<p>This statement tells PostGIS to use the buffer function <code>ST_Buffer</code>, which requires a geometry field <code>wkb_geometry</code> and a buffer distance <code>15</code> (meters in our case, because we re-projected the polygon to UTM Zone 10N in the last task), on the FSC polygon <code>FROM ubcv_fsc</code>, and then write the resulting buffer to a new table <code>INTO ubcv_fsc_buffer</code>.</p>
<p><strong>Step 3:</strong> Intersect the ubcv_campus_trees with the ubcv_fsc_buffer polygon you just made with the following SQL statement:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb14-1"><a href="analyze-relational-database.html#cb14-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">INTO</span> ubcv_fsc_trees <span class="kw">FROM</span> ubcv_campus_trees, ubcv_fsc_buffer <span class="kw">WHERE</span> ST_Intersects(wkb_geometry, st_buffer);</span></code></pre></div>
<p>The <code>ST_Intersects</code> takes two geometry fields <code>wkb_geometry</code> (ubcv_campus_trees) and <code>st_buffer</code> (ubcv_fsc_buffer), computes the intersection, and returns the features from the first geometry argument (ubcv_campus_trees) to a new table <code>INTO ubcv_fsc_trees</code>.</p>
<p>If you get an error here like this, <code>ERROR:  ST_Intersects: Operation on mixed SRID geometries (Point, 4326) != (Polygon, 3157)</code> then you know that you have not correctly changed the projection of the ubcv_campus_trees data when you imported it into your localhost postgres database. Go back to the last task and check Steps 5-7.</p>
<p><strong>Step 4:</strong> Open QGIS and then add ubcv_fsc, ubc_fsc_buffer, and ubcv_fsc_trees.wkb_geometry to your map to inspect them.</p>
<p><img src="images/02-qgis-fsc-buffer.png" width="75%" /></p>
<p><strong>Step 5:</strong> Now we will do a simple SQL query to determine the species that are planted around the Forest Sciences Building:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb15-1"><a href="analyze-relational-database.html#cb15-1" tabindex="-1"></a><span class="kw">SELECT</span> taxa, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> frequency <span class="kw">FROM</span> ubcv_fsc_trees <span class="kw">GROUP</span> <span class="kw">BY</span> taxa <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">DESC</span>;</span></code></pre></div>
<p>This will return the “taxa” column and create a new column called “frequency” that contains values of the <code>COUNT()</code> function. The <code>GROUP BY</code> statement is needed when we use an aggregation method like <code>COUNT()</code>. Finally, the relation is ordered by the aggregation result in descending <code>DESC</code> order.</p>
<p><img src="images/02-psql-final-analysis.png" width="90%" /></p>
<p><strong>Step 6:</strong> Modify the statement above to sort the taxa alphabetically.</p>
<p>These last few steps are just to illustrate that you can run the same SQL statements above directly in QGIS.</p>
<p><strong>Step 7:</strong> Open QGIS. From the top menu toolbar, select <strong>Database</strong> then <strong>DB Manager…</strong> This will open a new window where you can do basically everything you did in this task and the prior task. You can import/export data to whatever format you want, inspect the database, tables, and even preview the spatial features.</p>
<p><img src="images/02-qgis-db-manager.png" width="75%" /></p>
<p><strong>Step 8:</strong> At the top of the DB Manager window there is a small button to open an SQL tab. Click that and then enter the buffer statement again, but modify the output table name so that you do not create a conflict:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb16-1"><a href="analyze-relational-database.html#cb16-1" tabindex="-1"></a><span class="kw">SELECT</span> ST_Buffer(wkb_geometry, <span class="dv">15</span>) <span class="kw">INTO</span> ubcv_fsc_buffer_qgis <span class="kw">FROM</span> ubcv_fsc;</span></code></pre></div>
<p>You should now have a new table in the database now called <strong>ubcv_fsc_buffer_qgis</strong>. You can also save the query by giving it a name in the <strong>Name</strong> field and even output the SQL query to a file. This can be helpful for managing large complex queries. The <strong>Create a view</strong> button will display the layer in your map view.</p>
<p>Examine that query above carefully. Remember that <code>SELECT</code> operates on column names, so what exactly are we selecting when we apply a function on a column name? What is the output column name of that function that is returned in <strong>ubcv_fsc_buffer_qgis</strong>? Open the attribute table in QGIS and look at the column name. When we apply a function on a column and do not specify a name for the output column name of the function, then the default column name will simply be the name of the function. So in this case, the output column name will be <code>st_buffer</code>, which is not very informative.</p>
<p>Note that the default behaviour of any <code>SELECT</code> is to simply return the existing column names. However, we could choose to rename any of those in the table that is returned. For example:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb17-1"><a href="analyze-relational-database.html#cb17-1" tabindex="-1"></a><span class="kw">SELECT</span> name <span class="kw">AS</span> a, bldg_code <span class="kw">AS</span> b, postal_code <span class="kw">AS</span> c <span class="kw">FROM</span> ubcv_buildings </span>
<span id="cb17-2"><a href="analyze-relational-database.html#cb17-2" tabindex="-1"></a><span class="kw">WHERE</span> bldg_code <span class="op">=</span> <span class="st">&#39;FSC&#39;</span>;</span></code></pre></div>
<p>The <code>AS</code> is how we assign aliases to selected column names, which are returned in the new table. We can also completely omit <code>AS</code> and just provide the alias after the column name like:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb18-1"><a href="analyze-relational-database.html#cb18-1" tabindex="-1"></a><span class="kw">SELECT</span> name a, bldg_code b, postal_code c <span class="kw">FROM</span> ubcv_buildings </span>
<span id="cb18-2"><a href="analyze-relational-database.html#cb18-2" tabindex="-1"></a><span class="kw">WHERE</span> bldg_code <span class="op">=</span> <span class="st">&#39;FSC&#39;</span>;</span></code></pre></div>
<p>You should spend some time understanding this behaviour because it is very important for how you structure more complex queries, which we will examine next.</p>
<p><strong>Step 9:</strong> Using the <code>WITH</code> clause, combine all of our independent queries above into a single query in QGIS that buffers the FSC polygon by 15 m, intersects the buffer with the campus trees, and then reports the number of unique taxa around the building. See the screenshot below.</p>
<p><img src="images/02-qgis-complex-sql.png" width="75%" /></p>
<p>The <code>WITH</code> clause allows us to create temporary relations that can be referenced by name in subsequent <code>SELECT</code> statements. In the case above, <strong>ubcv_fsc_buffer_temporary</strong> is the temporary result from the buffer and <strong>ubcv_fsc_trees_temporary</strong> is the temporary result from intersecting the buffer with the campus trees.</p>
<p>As you will see, this is slightly different than using the <code>INTO</code> method from our prior examples, which creates a new relation in our database. The benefit of <code>WITH</code> and <code>AS</code> is that the relation is ephemeral and only exists for the moment that the SQL entire statement is executed; no new relation is written into our database.</p>
<p><strong>Step 10:</strong> Using what you have learned, select one of the other <a href="https://postgis.net/docs/reference.html#Overlay_Functions">PostGIS overlay methods</a> and then apply it to any two datasets in the <code>ubcv</code> database on the UBC PostgreSQL server. You must use the <code>WITH</code> clause and you must also use one of the <a href="https://www.postgresql.org/docs/17/functions-aggregate.html">SQL aggregation functions</a>. Refer to the examples provided in class and use those as a template to explore how these functions work. It is not important that your analysis makes sense, but it is important that your entire SQL statement can be executed from either QGIS or psql. Once your are satisfied with your SQL statement, copy and paste it to the assignment submission page on the course management system.</p>
<p>Hint: Check what the geometry column name is called for the layers that you choose to use and enter those exactly as you see them into your overlay function. Make sure that you are using compatible geometries for the overlay method you choose and read the linked documentation above if you have any doubts!</p>
<hr />
</div>
<div id="summary-1" class="section level2 unnumbered hasAnchor">
<h2>Summary<a href="analyze-relational-database.html#summary-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>PostGIS has many powerful functions for handling geospatial data directly within a PostgreSQL database. These are not always practical for day-to-day use when compared with user-friendly applications like QGIS or ArcGIS Pro. However, you should now appreciate that you can remotely manipulate geospatial data on a server and this opens the possibility of very powerful web-based applications, cloud-based GIS solutions, and automated scripting that requires little visualization. If you are interested in learning more about what others have done, you can check out the <a href="https://www.youtube.com/@CrunchyDataPostgres">Crunchy Data YouTube channel</a> to see past “PostGIS Day” recordings.</p>
<p>Return to the <strong><a href="analyze-relational-database.html#lab2-deliverables">Deliverables</a></strong> section to check off everything you need to submit for credit in the course management system.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction-postgresql-postgis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cartographic-modelling-with-forest-inventories.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["open-geomatics-community-of-practice.pdf"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
